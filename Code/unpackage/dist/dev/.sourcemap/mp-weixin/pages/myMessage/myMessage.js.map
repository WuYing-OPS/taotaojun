{"version":3,"sources":["uni-app:///main.js","webpack:///C:/Users/12770/Documents/HBuilderProjects/TTJ/pages/myMessage/myMessage.vue?c227","webpack:///C:/Users/12770/Documents/HBuilderProjects/TTJ/pages/myMessage/myMessage.vue?d70b","webpack:///C:/Users/12770/Documents/HBuilderProjects/TTJ/pages/myMessage/myMessage.vue?02eb","webpack:///C:/Users/12770/Documents/HBuilderProjects/TTJ/pages/myMessage/myMessage.vue?76e1","uni-app:///pages/myMessage/myMessage.vue","webpack:///C:/Users/12770/Documents/HBuilderProjects/TTJ/pages/myMessage/myMessage.vue?903c","webpack:///C:/Users/12770/Documents/HBuilderProjects/TTJ/pages/myMessage/myMessage.vue?793b"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,wG;AACAA,UAAU,CAACC,kBAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAsH;AACtH;AAC6D;AACL;AACc;;;AAGtE;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,+EAAM;AACR,EAAE,oFAAM;AACR,EAAE,6FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,wFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAmmB,CAAgB,6nBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC4DvnB;AACA,MADA,kBACA;AACA;AACA,mBADA;AAEA,eAFA;AAGA,mBAHA;AAIA,2BAJA;AAKA,qBALA,EAKA;AACA,wBANA;AAOA,6BAPA;AAQA,aARA;AASA,sBATA;AAUA,sBAVA;;AAYA,GAdA;AAeA;AACA;AACA,cAFA,sBAEA,OAFA,EAEA,IAFA,EAEA;AACA,oBADA,GACA,KADA;AAEA,uFAFA;AAGA;AACA,0CADA;AAEA;AACA,uCADA,EAFA;;AAKA,sBALA,CAKA;AACA;AACA,4GADA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAJA;AAKA,uBANA,MAMA;AACA;AACA;AACA,qBAVA,EAUA,GAVA;AAWA;AACA;AACA;AACA,iDADA;AAEA;AACA,8CADA;AAEA,iDAFA;AAGA,oCAHA,EAFA;;AAOA,0BAPA,CAOA;AACA;AACA;AACA,yBAFA,MAEA;AACA;AACA;AACA,uBAbA,EAaA,KAbA,CAaA;AACA;AACA,uBAfA;AAgBA,qBAjBA,MAiBA;AACA;AACA,iDADA;AAEA;AACA,uCADA;AAEA,oCAFA;AAGA,sDAHA;AAIA,qDAJA,EAFA;;AAQA,0BARA,CAQA;AACA;AACA;AACA,yBAFA,MAEA;AACA;AACA;AACA,uBAdA,EAcA,KAdA,CAcA;AACA;AACA,uBAhBA;AAiBA,qBAlBA,MAkBA;AACA;AACA,qCADA;AAEA,+BAFA,mBAEA,GAFA,EAEA;AACA;AACA;AACA,qDADA;AAEA;AACA,8CADA;AAEA,2CAFA;AAGA,wCAHA,EAFA;;AAOA,8BAPA,CAOA;AACA;AACA;AACA,6BAFA,MAEA;AACA;AACA;AACA,2BAbA,EAaA,KAbA,CAaA;AACA;AACA,2BAfA;AAgBA,yBApBA;;AAsBA;AACA,mBAjFA,CAHA;AAqFA,KAvFA;AAwFA;AACA,gBAzFA,wBAyFA,CAzFA,EAyFA;AACA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA,KAhGA;AAiGA,SAjGA,mBAiGA;AACA;AACA,oBADA;AAEA,qBAFA;;AAIA,KAtGA;AAuGA,aAvGA,qBAuGA,CAvGA,EAuGA,IAvGA,EAuGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBADA;AAEA,eAFA,mBAEA,GAFA,EAEA;AACA;AACA,+CADA;AAEA;AACA,8BADA,EAFA;;AAKA,cALA,CAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CADA;AAEA;AACA,mCADA,EAFA;;AAKA,oBALA,CAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BALA;AAMA;;AAEA;AACA,yDADA;AAEA;AACA,4CADA,EAFA;;AAKA,4BALA,CAKA;AACA;AACA;AACA;AACA;AACA;AACA,2BAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAHA;AAIA;AACA;AACA;AACA;AACA;AACA,6BAbA;AAcA;AACA;AACA;AACA,2BApBA,MAoBA;AACA;AACA;AACA;AACA,yBAtCA;AAuCA,uBAtDA;AAuDA;;AAEA,mBA5DA,MA4DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAJA;AAKA;AACA;AACA,yDADA;AAEA;AACA,4CADA,EAFA;;AAKA,4BALA,CAKA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,6BAJA;AAKA;AACA,2BAPA,MAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAHA;AAIA;AACA;AACA,6BAVA;AAWA;AACA;AACA,2BAhBA,MAgBA;AACA;AACA;AACA;AACA,yBA3CA;AA4CA,uBAxDA;AAyDA;;;AAGA;AACA,iBApIA;;AAsIA,eAxIA;AAyIA,aA3IA,MA2IA;AACA;AACA;AACA,iDADA;AAEA;AACA,oCADA,EAFA;;AAKA,oBALA,CAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAJA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAHA;AAIA;AACA;AACA,qBAVA;AAWA;AACA;AACA;AACA,mBAhBA,MAgBA;AACA;AACA;AACA;AACA,iBAvCA;AAwCA,eAzCA,MAyCA;AACA;AACA,iDADA;AAEA;AACA,oCADA,EAFA;;AAKA,oBALA,CAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAJA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAHA;AAIA;AACA;AACA,qBAVA;AAWA;AACA;AACA;AACA,mBAjBA,MAiBA;AACA;AACA;AACA;AACA,iBAxCA;AAyCA;AACA;AACA,WAxOA;AAyOA,SA5OA;;AA8OA,KA7VA;AA8VA;AACA,WA/VA,mBA+VA,WA/VA,EA+VA;AACA,uCADA,CACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAxWA;AAyWA;AACA,WA1WA,qBA0WA;AACA;AACA;AACA;AACA,yBADA;AAEA,kBAFA;;AAIA;AACA;AACA;AACA;AACA,SAHA,EAGA,GAHA;AAIA,OALA,MAKA;AACA;AACA;AACA;AACA;AACA;AACA,WAJA;AAKA;AACA,SAPA,EAOA,GAPA;AAQA;AACA;AACA;AACA,qBADA;AAEA,eAFA,mBAEA,GAFA,EAEA;AACA;AACA;AACA,+CADA;AAEA;AACA,8BADA,EAFA;;AAKA,cALA,CAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0CADA;AAEA;AACA,mCADA,EAFA;;AAKA,oBALA,CAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDADA;AAEA;AACA,6CADA;AAEA,gDAFA;AAGA,sCAHA,EAFA;;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDADA;AAEA;AACA,2DADA;AAEA,0DAFA;AAGA,0CAHA;AAIA,4CAJA,EAFA;;AAQA,iCARA,CAQA;AACA;AACA,6BAVA;AAWA;AACA,yBAfA;AAgBA;AACA,qBA/BA;AAgCA;AACA,iBAzCA;AA0CA,eA5CA;AA6CA;AACA,WAvDA;AAwDA;AACA,2CADA;AAEA;AACA,8BADA,EAFA;;AAKA,cALA,CAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CADA;AAEA;AACA,sCADA;AAEA,iCAFA;AAGA,gCAHA,EAFA;;AAOA,sBAPA,CAOA;AACA;AACA,mBATA,EASA,KATA,CASA;AACA;AACA,mBAXA;AAYA;AACA,eAhBA;AAiBA;AACA,WA1BA;AA2BA,SAvFA;;AAyFA,KA1dA,EAfA;;AA2eA,SA3eA,qBA2eA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAHA;AAIA;AACA;AACA,SAXA;AAYA;AACA;AACA;AACA;;AAEA,KAvBA;AAwBA,GArgBA;AAsgBA,UAtgBA,sBAsgBA;AACA;AACA,GAxgBA,E;;;;;;;;;;;;;AC5DA;AAAA;AAAA;AAAA;AAAqmC,CAAgB,+kCAAG,EAAC,C;;;;;;;;;;;ACAznC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/myMessage/myMessage.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/myMessage/myMessage.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./myMessage.vue?vue&type=template&id=3f5bfdfe&\"\nvar renderjs\nimport script from \"./myMessage.vue?vue&type=script&lang=js&\"\nexport * from \"./myMessage.vue?vue&type=script&lang=js&\"\nimport style0 from \"./myMessage.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/myMessage/myMessage.vue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./myMessage.vue?vue&type=template&id=3f5bfdfe&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./myMessage.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./myMessage.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"cu-custom\">\r\n\t\t\t<cu-custom bgColor=\"bg-gradual-orange\" :isBack=\"true\">\r\n\t\t\t\t<block slot=\"content\">消息</block>\r\n\t\t\t\t<block slot=\"backText\">返回</block>\r\n\t\t\t</cu-custom>\r\n\t\t</view>\r\n\t\t<view class=\"flex justify-between bg-white padding\">\r\n\t\t\t<view class=\"\">\r\n\t\t\t\t消息列表\r\n\t\t\t</view>\r\n\t\t\t<view class=\"cuIcon-edit text-orange\" @click=\"allRead\">\r\n\t\t\t\t全部标为已读\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<scroll-view scroll-x class=\"bg-white nav margin-top-sm\">\r\n\t\t\t<view class=\"flex text-center\">\r\n\t\t\t\t<view class=\"cu-item flex-sub\" :class=\"index==TabCur?'text-orange cur':''\" v-for=\"(item,index) in navList\" :key=\"index\"\r\n\t\t\t\t @tap=\"tabSelect($event,item)\" :data-id=\"index\">\r\n\t\t\t\t\t{{item}}\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t\t<view class=\"cu-list menu-avatar margin-top-xs\">\r\n\t\t\t<view class=\"cu-item \" v-for=\"(item,index) in commentList\" :key=\"index\" @click=\"goToDetail(item.storeID||item.store_id,item)\">\r\n\t\t\t\t<view v-if=\"item.isParent\" class=\"cu-avatar radius lg\" :style=\"{backgroundImage:`url(${item.clickAvatarUrl})`}\"></view>\r\n\t\t\t\t<view v-else class=\"cu-avatar radius lg\" :style=\"{backgroundImage:`url(${item.replyAvatarUrl})`}\"></view>\r\n\t\t\t\t<view class=\"content\">\r\n\t\t\t\t\t<view class=\"text-pink\">\r\n\t\t\t\t\t\t<view class=\"text-cut\">\r\n\t\t\t\t\t\t\t<text v-if=\"item.isParent\">{{item.clickNickName}}</text>\r\n\t\t\t\t\t\t\t<text v-else>{{item.replyNickName}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"text-gray text-sm flex\">\r\n\t\t\t\t\t\t<view class=\"text-cut\">\r\n\t\t\t\t\t\t\t<text v-if=\"item.isParent\">{{item.commentValue}}</text>\r\n\t\t\t\t\t\t\t<text v-else-if=\"item.isChildren\">{{item.replyContent}}</text>\r\n\t\t\t\t\t\t\t<text v-else>{{item.comment}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"action margin-right-sm\">\r\n\t\t\t\t\t<view class=\"text-grey text-xs\">{{item.ctime}}</view>\r\n\t\t\t\t\t<view class=\"cuIcon-title text-orange\" v-if=\"!item.read\"></view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"cu-load over\" v-if=\"!loadmoreShow\"></view>\r\n\t\t<l-loadmore :show=\"loadmoreShow\" :type=\"loadmoretype\" loading-text=\"努力加载中~\" />\r\n\t\t<view class='goTop' @click=\"goTop\">\r\n\t\t\t<image src='https://vkceyugu.cdn.bspapp.com/VKCEYUGU-aliyun-l5j2urmfatyb41ea37/580b4200-2728-11eb-b680-7980c8a877b8.png'\r\n\t\t\t v-if=\"!showTop\"></image>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tshowTop: true,\r\n\t\t\t\tTabCur: 0,\r\n\t\t\t\tscrollLeft: 0,\r\n\t\t\t\tnavList: ['全部', '未读'],\r\n\t\t\t\tcommentList: '', //全部消息列表\r\n\t\t\t\tloadmoreShow: true,\r\n\t\t\t\tloadmoretype: 'loading',\r\n\t\t\t\tskip: 1,\r\n\t\t\t\tpullDownLimit: 5,\r\n\t\t\t\tcurrentNav: '全部'\r\n\t\t\t};\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 跳转详情页\r\n\t\t\tasync goToDetail(storeID, item) {\r\n\t\t\t\tconst that = this\r\n\t\t\t\tconsole.log(\"jkshcvsdhvuhsukvdsvsduvuksvshkj\", item, that.commentList)\r\n\t\t\t\tawait uniCloud.callFunction({\r\n\t\t\t\t\tname: 'getStoreDetail',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tstore_id: storeID\r\n\t\t\t\t\t}\r\n\t\t\t\t}).then(res => {\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl: '../detail/detail?data=' + encodeURIComponent(JSON.stringify(res.result.data[0]))\r\n\t\t\t\t\t})\r\n\t\t\t\t\t// 去除已读的点或者在未读界面去除已读的消息\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tif (that.currentNav === '未读') {\r\n\t\t\t\t\t\t\tthat.commentList.forEach((el, i) => {\r\n\t\t\t\t\t\t\t\tif (el._id === item._id) {\r\n\t\t\t\t\t\t\t\t\tthat.commentList.splice(i, 1)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\titem.read = true\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 500)\r\n\t\t\t\t\t// 将当前消息的未读改为已读,判断点击的是哪里的评论\r\n\t\t\t\t\tif (item.isParent) {\r\n\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\tname: 'updateCommentRead',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tquestionId: item._id,\r\n\t\t\t\t\t\t\t\tisParent: item.isParent,\r\n\t\t\t\t\t\t\t\tread: true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\tif (getApp().globalData.unReadCount > 0) {\r\n\t\t\t\t\t\t\t\tgetApp().globalData.unReadCount = getApp().globalData.unReadCount - 1\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tgetApp().globalData.unReadCount = 0\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).catch(res => {\r\n\t\t\t\t\t\t\tconsole.log(\"出现异常\", res)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else if (item.isChildren) {\r\n\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\tname: 'updateCommentRead',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t_id: item._id,\r\n\t\t\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\t\t\tquestionId: item.question_id,\r\n\t\t\t\t\t\t\t\tisChildren: item.isChildren\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\tif (getApp().globalData.unReadCount > 0) {\r\n\t\t\t\t\t\t\t\tgetApp().globalData.unReadCount = getApp().globalData.unReadCount - 1\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tgetApp().globalData.unReadCount = 0\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).catch(res => {\r\n\t\t\t\t\t\t\tconsole.log(\"出现异常\", res)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.getStorage({\r\n\t\t\t\t\t\t\tkey: 'openid',\r\n\t\t\t\t\t\t\tsuccess(RES) {\r\n\t\t\t\t\t\t\t\tconsole.log(\"vjsvusuvsuvushudihuifgyuw78y8y8\", item._id)\r\n\t\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\t\tname: 'updateCommentRead',\r\n\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\topenid: RES.data,\r\n\t\t\t\t\t\t\t\t\t\t_id: item._id,\r\n\t\t\t\t\t\t\t\t\t\tread: true\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\t\t\tif (getApp().globalData.unReadCount > 0) {\r\n\t\t\t\t\t\t\t\t\t\tgetApp().globalData.unReadCount = getApp().globalData.unReadCount - 1\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tgetApp().globalData.unReadCount = 0\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}).catch(res => {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"出现异常\", res)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 点击回到顶部\r\n\t\t\tonPageScroll(e) {\r\n\t\t\t\t// this.scrollTop = e.scrollTop\r\n\t\t\t\tif (e.scrollTop > 500) {\r\n\t\t\t\t\tthis.showTop = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.showTop = true;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tgoTop() {\r\n\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\tscrollTop: 0,\r\n\t\t\t\t\tduration: 300\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\ttabSelect(e, item) {\r\n\t\t\t\tconst that = this\r\n\t\t\t\tthis.TabCur = e.currentTarget.dataset.id;\r\n\t\t\t\tthis.scrollLeft = (e.currentTarget.dataset.id - 1) * 60\r\n\t\t\t\tthis.currentNav = item\r\n\t\t\t\tthis.commentList = ''\r\n\t\t\t\tthis.loadmoreShow = true\r\n\t\t\t\tthis.loadmoretype = 'loading' \r\n\t\t\t\tuni.getStorage({\r\n\t\t\t\t\tkey: 'openid',\r\n\t\t\t\t\tsuccess(RES) {\r\n\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\tname: 'getUserPublishStoreByOpenid',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\topenid: RES.data\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\tconsole.log(\"getUserPublishStoreByOpenid\",res.result.data)\r\n\t\t\t\t\t\t\tif (res.result.data.length != 0) {\r\n\t\t\t\t\t\t\t\t// 拿到了当前用户发布的所有商品\r\n\t\t\t\t\t\t\t\tres.result.data.forEach(function(v, i) {\r\n\t\t\t\t\t\t\t\t\t// 拿到当前用户的商品id，去请求questionTable\r\n\t\t\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\t\t\tname: 'getQuestionTable',\r\n\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\tstore_id: v._id\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log('getQuestionTable',res.result.data)\r\n\t\t\t\t\t\t\t\t\t\t// 判断所有的商品是不是都有评论，有评论的拿出来\r\n\t\t\t\t\t\t\t\t\t\tif (item === '全部') {\r\n\t\t\t\t\t\t\t\t\t\t\tlet myCommentList = []\r\n\t\t\t\t\t\t\t\t\t\t\tif (res.result.data.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tres.result.data.forEach(function(v, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (v.clickOpenid != RES.data) { //判断评论表是不是自己评论的\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"parent\", v)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmyCommentList.push(v)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t//判断当前商品的评论中是不是有回复\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (v.children.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.children.forEach(function(val, ind) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"children\", val)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (val.replyOpenID != RES.data) { //判断回复表是不是自己回复的\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmyCommentList.push(val)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'getOtherCommentByOpenid',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\topenid: RES.data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 将两个数组中的对象进行合并\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet newMyCommentList\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 拿出otherComment的read为false的评论\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (res.result.data.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewMyCommentList = [...myCommentList, ...res.result.data[0].commentsList]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewMyCommentList = [...myCommentList]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (newMyCommentList.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet commentCount = 0\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet newData = []\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewMyCommentList.forEach(el => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet newTime = that.getTime(el.ctime)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tel.ctime = newTime\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (el.children) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tel.children.forEach(el => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet childrenNewTime = that.getTime(el.ctime)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tel.ctime = childrenNewTime\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewData.push(el)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (el.read === false) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcommentCount += 1\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgetApp().globalData.unReadCount = commentCount\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthat.commentList = newData\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthat.loadmoretype = 'end'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthat.commentList = \"\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthat.loadmoreShow = false\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t} else if (item === '未读') {\r\n\t\t\t\t\t\t\t\t\t\t\tlet myCommentList = []\r\n\t\t\t\t\t\t\t\t\t\t\tif (res.result.data.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tres.result.data.forEach(function(v, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (v.clickOpenid != RES.data && v.read === false) { //判断评论表是不是自己评论的\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmyCommentList.push(v)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t//判断当前商品的评论中是不是有回复\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (v.children.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tv.children.forEach(function(val, ind) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (val.replyOpenID != RES.data && val.read === false) { //判断回复表是不是自己评论的\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmyCommentList.push(val)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'getOtherCommentByOpenid',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\topenid: RES.data\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 将两个数组中的对象进行合并\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(myCommentList, res)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet newMyCommentList\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 拿出otherComment的read为false的评论\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet otherCommentList = []\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (res.result.data.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tres.result.data[0].commentsList.forEach(el => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (el.read === false) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\totherCommentList.push(el)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewMyCommentList = [...myCommentList, ...otherCommentList]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewMyCommentList = [...myCommentList]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tgetApp().globalData.unReadCount = newMyCommentList.length\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (newMyCommentList.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// that.commentList = newMyCommentList\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet newData = []\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewMyCommentList.forEach(el => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet newTime = that.getTime(el.ctime)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tel.ctime = newTime\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (el.children) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tel.children.forEach(el => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet childrenNewTime = that.getTime(el.ctime)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tel.ctime = childrenNewTime\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewData.push(el)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthat.commentList = newData\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthat.loadmoretype = 'end'\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthat.commentList = \"\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tthat.loadmoreShow = false\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t} else if (res.result.data.length === 0) {\r\n\t\t\t\t\t\t\t\tif (item === '全部') {\r\n\t\t\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\t\t\tname: 'getOtherCommentByOpenid',\r\n\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\topenid: RES.data\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\t\t\t\t// 将两个数组中的对象进行合并\r\n\t\t\t\t\t\t\t\t\t\tlet newMyCommentList\r\n\t\t\t\t\t\t\t\t\t\t// 拿出otherComment的read为false的评论\r\n\t\t\t\t\t\t\t\t\t\tif (res.result.data.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet commentCount = 0\r\n\t\t\t\t\t\t\t\t\t\t\tnewMyCommentList = [...res.result.data[0].commentsList]\r\n\t\t\t\t\t\t\t\t\t\t\tnewMyCommentList.forEach(el => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (el.read === false) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcommentCount += 1\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\tgetApp().globalData.unReadCount = commentCount\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tif (newMyCommentList.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet newData = []\r\n\t\t\t\t\t\t\t\t\t\t\tnewMyCommentList.forEach(el => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tlet newTime = that.getTime(el.ctime)\r\n\t\t\t\t\t\t\t\t\t\t\t\tel.ctime = newTime\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (el.children) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tel.children.forEach(el => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet childrenNewTime = that.getTime(el.ctime)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tel.ctime = childrenNewTime\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tnewData.push(el)\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\tthat.commentList = newData\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(that.commentList, \"that.commentList \")\r\n\t\t\t\t\t\t\t\t\t\t\tthat.loadmoretype = 'end'\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tthat.commentList = \"\"\r\n\t\t\t\t\t\t\t\t\t\t\tthat.loadmoreShow = false\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t} else if (item === '未读') {\r\n\t\t\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\t\t\tname: 'getOtherCommentByOpenid',\r\n\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\topenid: RES.data\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\t\t\t\t// 将两个数组中的对象进行合并\r\n\t\t\t\t\t\t\t\t\t\tlet newMyCommentList\r\n\t\t\t\t\t\t\t\t\t\t// 拿出otherComment的read为false的评论\r\n\t\t\t\t\t\t\t\t\t\tlet otherCommentList = []\r\n\t\t\t\t\t\t\t\t\t\tif (res.result.data.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tres.result.data[0].commentsList.forEach(el => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (el.read === false) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\totherCommentList.push(el)\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\tnewMyCommentList = [...otherCommentList]\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tgetApp().globalData.unReadCount = newMyCommentList.length\r\n\t\t\t\t\t\t\t\t\t\tif (newMyCommentList.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t// that.commentList = newMyCommentList\r\n\t\t\t\t\t\t\t\t\t\t\tlet newData = []\r\n\t\t\t\t\t\t\t\t\t\t\tnewMyCommentList.forEach(el => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tlet newTime = that.getTime(el.ctime)\r\n\t\t\t\t\t\t\t\t\t\t\t\tel.ctime = newTime\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (el.children) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tel.children.forEach(el => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet childrenNewTime = that.getTime(el.ctime)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tel.ctime = childrenNewTime\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tnewData.push(el)\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\tthat.commentList = newData\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(that.commentList, \"that.commentList \")\r\n\t\t\t\t\t\t\t\t\t\t\tthat.loadmoretype = 'end'\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tthat.commentList = \"\"\r\n\t\t\t\t\t\t\t\t\t\t\tthat.loadmoreShow = false\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 对获取到的数据进行时间的处理\r\n\t\t\tgetTime(shijianchuo) {\r\n\t\t\t\tvar date = new Date(shijianchuo); //时间戳为10位需*1000，时间戳为13位的话不需乘1000\r\n\t\t\t\tvar Y = date.getFullYear() + '-';\r\n\t\t\t\tvar M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';\r\n\t\t\t\tvar D = date.getDate() + ' ';\r\n\t\t\t\tvar h = date.getHours() + ':';\r\n\t\t\t\tvar m = date.getMinutes() < 10 ? '0' + date.getMinutes() + ':' : date.getMinutes() + ':';\r\n\t\t\t\tvar s = date.getSeconds();\r\n\t\t\t\treturn Y + M + D + h + m + s;\r\n\t\t\t},\r\n\t\t\t// 全部标为已读\r\n\t\t\tallRead() {\r\n\t\t\t\tconst that = this\r\n\t\t\t\tgetApp().globalData.unReadCount = 0\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '服务请求中...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t})\r\n\t\t\t\tif (this.currentNav === '未读') {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tthat.commentList = null\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}, 500)\r\n\t\t\t\t} else if (this.currentNav === \"全部\") {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\tthat.commentList.forEach(el => {\r\n\t\t\t\t\t\t\tif (el.read === false) {\r\n\t\t\t\t\t\t\t\tel.read = true\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}, 500)\r\n\t\t\t\t}\r\n\t\t\t\t// 拿到当前用户的openid，查找当前用户发布的所有商品，拿到商品的id\r\n\t\t\t\tuni.getStorage({\r\n\t\t\t\t\tkey: 'openid',\r\n\t\t\t\t\tsuccess(RES) {\r\n\t\t\t\t\t\t// 拿到用户的openid后\r\n\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\tname: 'getUserPublishStoreByOpenid',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\topenid: RES.data\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).then((res) => {\r\n\t\t\t\t\t\t\t// 拿到了当前用户发布的所有商品\r\n\t\t\t\t\t\t\tconsole.log(\"拿到了当前用户发布的所有商品\", res.result)\r\n\t\t\t\t\t\t\tif (res.result.data.length != 0) {\r\n\t\t\t\t\t\t\t\tres.result.data.forEach(function(v, i) {\r\n\t\t\t\t\t\t\t\t\t// 拿到当前用户的商品id，去请求questionTable\r\n\t\t\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\t\t\tname: 'getQuestionTable',\r\n\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\tstore_id: v._id\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\t\t\t\t// 判断所有的商品是不是都有评论，有评论的拿出来\r\n\t\t\t\t\t\t\t\t\t\tif (res.result.data.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tres.result.data.forEach(function(v, i) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (v.clickOpenid != RES.data && v.read == false) { //判断评论表是不是自己评论的\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"parent\", v)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'updateCommentRead',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tquestionId: v._id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisParent: v.isParent,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tread: true\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t//判断当前商品的评论中是不是有回复\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (v.children.length != 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tv.children.forEach(function(val, ind) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (val.replyOpenID != RES.data && val.read == false) { //判断回复表是不是自己回复的\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"children\", val)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: 'updateCommentRead',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tquestionId: val.question_id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisChildren: val.isChildren,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tread: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t_id: val._id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}).catch(res => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"出现异常\", res)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\tname: 'getOtherCommentByOpenid',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\topenid: RES.data\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\tconsole.log(\"cccccccccccccccccccccccc\", res.result.data[0].commentsList)\r\n\t\t\t\t\t\t\tif (res.result.data[0].commentsList.length != 0) {\r\n\t\t\t\t\t\t\t\tres.result.data[0].commentsList.forEach(el => {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"el\", el)\r\n\t\t\t\t\t\t\t\t\tif (el.read === false) {\r\n\t\t\t\t\t\t\t\t\t\tuniCloud.callFunction({\r\n\t\t\t\t\t\t\t\t\t\t\tname: 'updateCommentRead',\r\n\t\t\t\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\t\t\t\topenid: RES.data,\r\n\t\t\t\t\t\t\t\t\t\t\t\t_id: el._id,\r\n\t\t\t\t\t\t\t\t\t\t\t\tread: true\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"getOtherCommentByOpenid修改成功\", res)\r\n\t\t\t\t\t\t\t\t\t\t}).catch(res => {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"出现异常\", res)\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tconst that = this\r\n\t\t\tuni.$on('myCommentList', data => {\r\n\t\t\t\tif (!data) {\r\n\t\t\t\t\t// 判断是否有评论\r\n\t\t\t\t\tthis.loadmoreShow = false\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet newData = []\r\n\t\t\t\t\tdata.forEach(el => {\r\n\t\t\t\t\t\tconsole.log(el.ctime)\r\n\t\t\t\t\t\tlet newTime = that.getTime(el.ctime)\r\n\t\t\t\t\t\tel.ctime = newTime\r\n\t\t\t\t\t\tif (el.children) {\r\n\t\t\t\t\t\t\tel.children.forEach(el => {\r\n\t\t\t\t\t\t\t\tlet childrenNewTime = that.getTime(el.ctime)\r\n\t\t\t\t\t\t\t\tel.ctime = childrenNewTime\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnewData.push(el)\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.commentList = newData\r\n\t\t\t\t\tconsole.log(\"this.commentList\", this.commentList)\r\n\t\t\t\t\tthis.loadmoretype = 'end'\r\n\t\t\t\t}\r\n\r\n\t\t\t})\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tuni.$off('myCommentList')\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t.cu-list.menu-avatar>.cu-item .action {\r\n\t\twidth: 190rpx;\r\n\t\ttext-align: right;\r\n\t}\r\n\r\n\t.cu-list.menu-avatar>.cu-item .content {\r\n\t\twidth: 300rpx;\r\n\t}\r\n</style>\n","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./myMessage.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./myMessage.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1608014567535\n      var cssReload = require(\"D:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}